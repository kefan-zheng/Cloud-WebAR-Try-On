<!DOCTYPE html>
<html lang="en">
	<head>
		<title>MEETING</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	</head>

	<body>

	<canvas id="canvas" style="position:fixed;top:0px;left:0px;z-index:-1;"></canvas>
	<video id="video" width="1000px" height="1000px" autoplay="autoplay"style="position:fixed;top:0px;left:0px;z-index:-2;"></video>
	<script>
		var w = window.innerWidth;
		var h = window.innerHeight;
		//let mediaStreamTrack=null; // 视频对象(全局)
		//开始进行相机相关代码
		let video ;
		function openMedia() {
			let constraints = {
				video: { width: w, height: h },
				audio: false
			};
			//获得video摄像头
			video = document.getElementById('video');
			video.width=w;
			video.height=h;
			let promise = navigator.mediaDevices.getUserMedia(constraints);
			promise.then((mediaStream) => {
				// mediaStreamTrack = typeof mediaStream.stop === 'function' ? mediaStream : mediaStream.getTracks()[1];
				mediaStreamTrack=mediaStream.getVideoTracks()
				video.srcObject = mediaStream;
				video.play();
			});
		}openMedia();
		//完成进行相机相关代码
	</script>

	<script src="js/lib/threeJS/three.js"></script>
	<script src="js/lib/threeJS/GLTFLoader.js"></script>

	<script src="js/lib/PlayerControl.js"></script>

	<script src="js/Main.js"></script>

	<script type="module">
		var myMain = new Main();
		myMain.start();

		new PlayerControl(myMain.camera);//.cullingTest(myMain.scene)

		console.log(myMain.renderer.domElement);
		

		//加载模型
		import * as THREE from './js/three.module.js';
		import { DDSLoader } from './js/loaders/DDSLoader.js';
    	import { MTLLoader } from './js/loaders/MTLLoader.js';
    	import { OBJLoader } from './js/loaders/OBJLoader.js';

		// model

        const onProgress = function ( xhr ) {

	if ( xhr.lengthComputable ) {

		const percentComplete = xhr.loaded / xhr.total * 100;
		console.log( Math.round( percentComplete, 2 ) + '% downloaded' );

	}

	};

	const onError = function () { };

	const manager = new THREE.LoadingManager();
	manager.addHandler( /\.dds$/i, new DDSLoader() );

	// comment in the following line and import TGALoader if your asset uses TGA textures
	// manager.addHandler( /\.tga$/i, new TGALoader() );

	new MTLLoader( manager )
	.setPath( 'models/' )
	.load( 'ring1.mtl', function ( materials ) {

		materials.preload();

		new OBJLoader( manager )
			.setMaterials( materials )
			.setPath( 'models/' )
			.load( 'ring1.obj', function ( object ) {

				object.position.y = -1000;
				object.position.x = 7000;
				object.position.z = -500;
				//object.rotation.set();
				myMain.scene.add( object );

			}, onProgress, onError );

	} );

	

	</script>
	</body>
</html>
